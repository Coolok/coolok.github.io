<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Sensors</title>

    <link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>
    <div id="frame">
        <div id="holder">
            <div id="out">
                <div id="arrow"></div>
            </div>
            <div id="error">
                Unsupported ðŸ˜¢
            </div>
        </div>
    </div>
    <script type="text/javascript">
        // from the spec: https://w3c.github.io/deviceorientation/spec-source-orientation.html

        var degtorad = Math.PI / 180; // Degree-to-Radian conversion

        function compassHeading(alpha, beta, gamma) {

            var _x = beta ? beta * degtorad : 0; // beta value
            var _y = gamma ? gamma * degtorad : 0; // gamma value
            var _z = alpha ? alpha * degtorad : 0; // alpha value

            var cX = Math.cos(_x);
            var cY = Math.cos(_y);
            var cZ = Math.cos(_z);
            var sX = Math.sin(_x);
            var sY = Math.sin(_y);
            var sZ = Math.sin(_z);

            // Calculate Vx and Vy components
            var Vx = -cZ * sY - sZ * sX * cY;
            var Vy = -sZ * sY + cZ * sX * cY;

            // Calculate compass heading
            var compassHeading = Math.atan(Vx / Vy);

            // Convert compass heading to use whole unit circle
            if (Vy < 0) {
                compassHeading += Math.PI;
            } else if (Vx < 0) {
                compassHeading += 2 * Math.PI;
            }

            return compassHeading * (180 / Math.PI); // Compass Heading (in degrees)

        }

        window.addEventListener('deviceorientation', function (event) {
            if (event.alpha === null) {
                return; // no support
            }
            var heading = -compassHeading(event.alpha, event.beta, event.gamma);
            holder.className = 'compass';
            arrow.style.transform = 'rotate(' + heading + 'deg)';
        }, false);

    </script>
</body>
</html>